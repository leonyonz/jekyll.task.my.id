<!DOCTYPE html>



<html lang="en-US" 
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy" />
<meta name="author" content="nurhamim" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Pada tutorial kali ini kita akan mencoba membuat high availabiliy postgresql, seperti yang telah diinformasikan pada tutorial – tutorial sebelumnya postgresql sendiri sebuah database server open source yang dapat digunakan karena postgresql sangat power full." />
<meta property="og:description" content="Pada tutorial kali ini kita akan mencoba membuat high availabiliy postgresql, seperti yang telah diinformasikan pada tutorial – tutorial sebelumnya postgresql sendiri sebuah database server open source yang dapat digunakan karena postgresql sangat power full." />
<link rel="canonical" href="/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/" />
<meta property="og:url" content="/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/" />
<meta property="og:site_name" content="Chirpy" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-09-07T22:03:38+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy" />
<meta name="twitter:site" content="@twitter_username" />
<meta name="twitter:creator" content="@nurhamim" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","dateModified":"2020-09-07T22:03:38+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/"},"author":{"@type":"Person","name":"nurhamim"},"description":"Pada tutorial kali ini kita akan mencoba membuat high availabiliy postgresql, seperti yang telah diinformasikan pada tutorial – tutorial sebelumnya postgresql sendiri sebuah database server open source yang dapat digunakan karena postgresql sangat power full.","headline":"High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy","datePublished":"2020-09-07T22:03:38+08:00","url":"/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy | Chirpy
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Chirpy">
<meta name="application-name" content="Chirpy">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScripts -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

  <script defer
    src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>

  <!--
  JS selector for site.
-->


  



  <!-- image lazy-loading & popup -->
  <script async
    src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>






</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Chirpy</a>
    </div>

    <div class="site-subtitle font-italic">A text-focused Jekyll theme</div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/categories/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        <span>CATEGORIES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/tags/" class="nav-link">
        <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i>
        <span>TAGS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/archives/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ARCHIVES</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://github.com/github_username" aria-label="github"
        class="order-3"
        target="_blank" rel="noopener">
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="https://twitter.com/twitter_username" aria-label="twitter"
        class="order-4"
        target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" aria-label="email"
        class="order-5"
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        class="order-6"
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    
      
        <span class="icon-border order-2"></span>
      

      <span id="mode-toggle-wrapper" class="order-1">
        <!--
  Switch the mode between dark and light.
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.updateMermaid();
      });

    } /* constructor() */


    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }

        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }

      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.updateMermaid();

    } /* flipMode() */

  } /* ModeToggle */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {

    toggle.flipMode();

  });

</script>

      </span>
    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span>High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" autocomplete="off" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            nurhamim
          </span>
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Mon, Sep  7, 2020, 10:03 PM +0800"
  

  
  prep="on" >

  
  

  
    Sep  7, 2020
  

  <i class="unloaded">2020-09-07T22:03:38+08:00</i>

</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1887 words">10 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>Pada tutorial kali ini kita akan mencoba membuat high availabiliy postgresql, seperti yang telah diinformasikan pada tutorial – tutorial sebelumnya postgresql sendiri sebuah database server open source yang dapat digunakan karena postgresql sangat power full.</p>

<p>Kali ini kita akan membuat cluster postgresql tujuannya untuk high availability dan menunjang kebutuhan aplikasi tentunya.</p>

<p>Berikut topologi yang akan kami gunakan</p>

<figure class="wp-block-image size-large"><img loading="lazy" width="591" height="681" src="/content/images/wordpress/2020/09/High-Available-PostgreSQL-Cluster-Menggunakan-Patroni.png" alt="" class="wp-image-482" srcset="/content/images/wordpress/2020/09/High-Available-PostgreSQL-Cluster-Menggunakan-Patroni.png 591w, /content/images/wordpress/2020/09/High-Available-PostgreSQL-Cluster-Menggunakan-Patroni-260x300.png 260w" sizes="(max-width: 591px) 100vw, 591px" /></figure>

<p>Dari topologi diatas kita perlu 5 node server atau virtual machine atau instance yang dapat digunakan dengan detail sebagai berikut</p>

<figure class="wp-block-table aligncenter"><div class="table-wrapper"><table><tbody>
<tr>
<td class="has-text-align-center" data-align="center">Name/Hostname</td>
<td class="has-text-align-center" data-align="center">IP Address Lokal / Public</td>
<td class="has-text-align-center" data-align="center">Keterangan</td>
</tr>
<tr>
<td class="has-text-align-center" data-align="center">Hamim-pg01 /node01</td>
<td class="has-text-align-center" data-align="center">192.168.10.21</td>
<td class="has-text-align-center" data-align="center">Postgresql, Patroni</td>
</tr>
<tr>
<td class="has-text-align-center" data-align="center">Hamim-pg02 /node02</td>
<td class="has-text-align-center" data-align="center">192.168.10.24</td>
<td class="has-text-align-center" data-align="center">Postgresql, Patroni</td>
</tr>
<tr>
<td class="has-text-align-center" data-align="center">Hamim-pg03 /node03</td>
<td class="has-text-align-center" data-align="center">192.168.10.28</td>
<td class="has-text-align-center" data-align="center">Postgresql, Patroni</td>
</tr>
<tr>
<td class="has-text-align-center" data-align="center">Hamim-etcd /node04</td>
<td class="has-text-align-center" data-align="center">192.168.10.27</td>
<td class="has-text-align-center" data-align="center">Etcd</td>
</tr>
<tr>
<td class="has-text-align-center" data-align="center">Hamim-Haproxy /node05</td>
<td class="has-text-align-center" data-align="center">192.168.10.23 / 103.93.52.117</td>
<td class="has-text-align-center" data-align="center">HAProxy</td>
</tr>
</tbody></table></div></figure>

<p>Keterangan:</p>

<p>– Patroni: Digunakan untuk mengelola konfigurasi postgresql <br />
– Etcd: Digunakan untuk cluster postgresql<br />
– HAProxy: Digunakan untuk failover atau load balancing postgresql</p>

<p>Pertama yang harus di lakukan yaitu melakukan update sistem operasi CentOS 8 Anda di masing – masing node dan disini kami setup hostname masing – masing node seperti berikut</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>#Node 01

[root@node01 ~]# hostnamectl |grep hostname
   Static hostname: node01.nurhamim.my.id
[root@node01 ~]#

#Node02

[root@node02 ~]# hostnamectl |grep hostname
   Static hostname: node02.nurhamim.my.id
[root@node02 ~]#

#Node03

[root@node03 ~]# hostnamectl |grep hostname
   Static hostname: node03.nurhamim.my.id
[root@node03 ~]#

#Node04

[root@node04 ~]# hostnamectl |grep hostname
   Static hostname: node04.nurhamim.my.id
[root@node04 ~]#

#Node05

[root@node05 ~]# hostnamectl |grep hostname
   Static hostname: node05.nurhamim.my.id
[root@node05 ~]#
</pre></td></tr></tbody></table></code></div></div>

<p>Selanjutnya menambahkan repository epel di <strong>node01, node02 dan node03</strong> dan install repository paket manager seperti berikut</p>

<p><strong>Node01</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node01 ~]#
[root@node01 ~]# dnf -y install epel-release -y

[root@node01 ~]# dnf config-manager --set-enabled PowerTools
[root@node01 ~]# dnf -y install yum-utils -y
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node02</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node02 ~]#
[root@node02 ~]# dnf -y install epel-release -y

[root@node02 ~]# dnf config-manager --set-enabled PowerTools
[root@node02 ~]# dnf -y install yum-utils -y
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node03 ~]#
[root@node03 ~]# dnf -y install epel-release -y

[root@node03 ~]# dnf config-manager --set-enabled PowerTools
[root@node03 ~]# dnf -y install yum-utils -y
</pre></td></tr></tbody></table></code></div></div>

<p>Selanjutnya menambahkan repository postgresql 12 di <strong>node01, node02, node03</strong> dan disable module postgresql default CentOS 8</p>

<p><strong>Node01</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>[root@node01 ~]#
[root@node01 ~]# dnf -y install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm

[root@node01 ~]# yum-config-manager --enable pgdg12
[root@node01 ~]# dnf -qy module disable postgresql
[root@node01 ~]#
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node02</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>[root@node02 ~]#
[root@node02 ~]# dnf -y install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm

[root@node02 ~]# yum-config-manager --enable pgdg12
[root@node02 ~]# dnf -qy module disable postgresql
[root@node02 ~]#
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node03 ~]# dnf -y install https://download.postgresql.org/pub/repos/yum/reporpms/EL-8-x86_64/pgdg-redhat-repo-latest.noarch.rpm

[root@node03 ~]# yum-config-manager --enable pgdg12
[root@node03 ~]# dnf -qy module disable postgresql
[root@node03 ~]#
</pre></td></tr></tbody></table></code></div></div>

<p>Selanjutnya install postgresql12 di <strong>node01, nod02 dan node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>[root@node01 ~]#
[root@node01 ~]# dnf -y install postgresql12-server postgresql12 postgresql12-devel

[root@node02 ~]#
[root@node02 ~]# dnf -y install postgresql12-server postgresql12 postgresql12-devel

[root@node03 ~]#
[root@node03 ~]# dnf -y install postgresql12-server postgresql12 postgresql12-devel
</pre></td></tr></tbody></table></code></div></div>

<p>Selanjutnya melakukan instalasi patroni. Patroni sendiri merupakan paket python dan open source yang dapat digunakan untuk mengelola konfigurasi Postgres. Selain itu dengan patroni Anda dapat melakukan konfigurasi yang komplek misalnya menangani tugas-tugas seperti replikasi, backup, dan restorasi.</p>

<p>Silakan install patroni di <strong>node01, node02 dan node03</strong></p>

<p><strong>Node01</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node01 ~]#
[root@node01 ~]# dnf -y install https://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/p/python3-psycopg2-2.7.7-2.el7.x86_64.rpm

[root@node01 ~]#
[root@node01 ~]# dnf -y install https://github.com/cybertec-postgresql/patroni-packaging/releases/download/1.6.0-1/patroni-1.6.0-1.rhel7.x86_64.rpm
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node02</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node02 ~]#
[root@node02 ~]# dnf -y install https://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/p/python3-psycopg2-2.7.7-2.el7.x86_64.rpm

[root@node02 ~]#
[root@node02 ~]# dnf -y install https://github.com/cybertec-postgresql/patroni-packaging/releases/download/1.6.0-1/patroni-1.6.0-1.rhel7.x86_64.rpm
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node03 ~]#
[root@node03 ~]# dnf -y install https://download-ib01.fedoraproject.org/pub/epel/7/x86_64/Packages/p/python3-psycopg2-2.7.7-2.el7.x86_64.rpm

[root@node03 ~]#
[root@node03 ~]# dnf -y install https://github.com/cybertec-postgresql/patroni-packaging/releases/download/1.6.0-1/patroni-1.6.0-1.rhel7.x86_64.rpm
</pre></td></tr></tbody></table></code></div></div>

<p>Sebelum melakukan konfigurasi patroni ada baiknya kita simpan default konfigurasi patroni tujuannya untuk jaga – jaga jika dikemudian hari membutuhkannya.</p>

<p>Silakan copy file konfigurasi patroni di <strong>nod01, node02 dan node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>[root@node01 ~]# cp -p /opt/app/patroni/etc/postgresql.yml.sample /opt/app/patroni/etc/postgresql.yml
[root@node01 ~]#

[root@node02 ~]# cp -p /opt/app/patroni/etc/postgresql.yml.sample /opt/app/patroni/etc/postgresql.yml
[root@node02 ~]#

[root@node03 ~]# cp -p /opt/app/patroni/etc/postgresql.yml.sample /opt/app/patroni/etc/postgresql.yml
[root@node03 ~]#
</pre></td></tr></tbody></table></code></div></div>

<p>Langkah selanjutnya melakukan konfigurasi patroni di <strong>node01, node02 dan node03</strong></p>

<p>Buka file konfigurasi patroni yang beradi di <em>/opt/app/patroni/etc/postgresql.yml</em> di masing – masing node postgresql</p>

<p>Berikut full konfigurasinya</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
</pre></td><td class="rouge-code"><pre>scope: postgres
namespace: /pg_cluster/
name: node1

restapi:
    listen: 192.168.10.21:8008
    connect_address: 192.168.10.21:8008

etcd:
    host: 192.168.10.27:2379

bootstrap:
  dcs:
    ttl: 30
    loop_wait: 10
    retry_timeout: 10
    maximum_lag_on_failover: 1048576
    postgresql:
      use_pg_rewind: true
      use_slots: true
      parameters:

  initdb:
  - encoding: UTF8
  - data-checksums

  pg_hba:
  - host replication replicator 127.0.0.1/32 md5
  - host replication replicator 192.168.10.21/27 md5
  - host replication replicator 192.168.10.24/27 md5
  - host replication replicator 192.168.10.28/27 md5
  - host all all 0.0.0.0/0 md5

  users:
    admin:
      password: admin
      options:
        - createrole
        - createdb

postgresql:
  listen: 192.168.10.21:5432
  connect_address: 192.168.10.21:5432
  data_dir: /var/lib/pgsql/12/data
  bin_dir: /usr/pgsql-12/bin
  pgpass: /tmp/pgpass
  authentication:
    replication:
      username: replicator
      password: reppassword
    superuser:
      username: postgres
      password: postgrespassword

categories:
    nofailover: false
    noloadbalance: false
    clonefrom: false
    nosync: false
</pre></td></tr></tbody></table></code></div></div>

<p><em>Noted: Silakan sesuaikan penamaan dan ip di setiap node – node postgresql dan serta pastikan input ip node04 etcd karena nantinya patroni akan berkomunikasi atau terhubung dengan etcd sebagai cluster.</em></p>

<p>Berikut contoh di konfigurasi patroni di <strong>node01, node02 dan node03</strong></p>

<p><strong>Node01</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node01 ~]#
[root@node01 ~]# vim /opt/app/patroni/etc/postgresql.yml
</pre></td></tr></tbody></table></code></div></div>

<figure class="wp-block-image size-large"><img loading="lazy" width="517" height="1007" src="/content/images/wordpress/2020/09/1-6.png" alt="" class="wp-image-483" srcset="/content/images/wordpress/2020/09/1-6.png 517w, /content/images/wordpress/2020/09/1-6-154x300.png 154w" sizes="(max-width: 517px) 100vw, 517px" /></figure>

<p><strong>Node02</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node02 ~]#
[root@node02 ~]# vim /opt/app/patroni/etc/postgresql.yml
</pre></td></tr></tbody></table></code></div></div>

<figure class="wp-block-image size-large"><img loading="lazy" width="516" height="1013" src="/content/images/wordpress/2020/09/2-6.png" alt="" class="wp-image-484" srcset="/content/images/wordpress/2020/09/2-6.png 516w, /content/images/wordpress/2020/09/2-6-153x300.png 153w" sizes="(max-width: 516px) 100vw, 516px" /></figure>

<p><strong>Node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node03 ~]#
[root@node03 ~]# vim /opt/app/patroni/etc/postgresql.yml
</pre></td></tr></tbody></table></code></div></div>

<figure class="wp-block-image size-large"><img loading="lazy" width="540" height="704" src="/content/images/wordpress/2020/09/image-19.png" alt="" class="wp-image-487" srcset="/content/images/wordpress/2020/09/image-19.png 540w, /content/images/wordpress/2020/09/image-19-230x300.png 230w" sizes="(max-width: 540px) 100vw, 540px" /></figure>

<p>Jika patroni digunakan sebagai pengelola si postgresql maka si etcd digunakan sebagai cluster patroni dan postgresql</p>

<p>Etcd adalah salah satu dari beberapa solusi untuk masalah yang dihadapi oleh banyak program yang berjalan secara terdistribusi pada sekumpulan host, yang masing-masing mungkin gagal atau perlu di-boot ulang kapan saja.</p>

<p>Etcd cluster juga dapat memonitoring dan menentukan streaming replication postgresql node mana yang akan menjadi sebagai primary dan node mana yang akan menjadi standby.</p>

<p>Dari beberapa referensi untuk lebih powerfull dan jika sudah masuk ke production sangat disarankan menggunakan etcd di masing – masing node patroni dan untuk tutorial kali ini kita hanya menggunakan satu node saja. Kenapa menggunakan banyak node etcd?. Tujuannya jika terdapat salah satu node etcd down maka tidak akan memngaruhi node postgresql Anda.</p>

<p>Etcd Cluster disini kami akan diinstall di <strong>Node04</strong> dan berikut cara instalasinya</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node04 ~]#
[root@node04 ~]# dnf -y install http://mirror.centos.org/centos/7/extras/x86_64/Packages/etcd-3.3.11-2.el7.centos.x86_64.rpm
</pre></td></tr></tbody></table></code></div></div>

<p>Konfigurasi etcd</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node04 ~]#
[root@node04 ~]# vim /etc/etcd/etcd.conf
</pre></td></tr></tbody></table></code></div></div>

<p>Berikut full konfigurasi etcd</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre>#[Member]

#ETCD_CORS=""
ETCD_DATA_DIR="/var/lib/etcd/default.etcd"
#ETCD_WAL_DIR=""
ETCD_LISTEN_PEER_URLS="http://192.168.10.27:2380"
ETCD_LISTEN_CLIENT_URLS="http://192.168.10.27:2379"
#ETCD_MAX_SNAPSHOTS="5"
#ETCD_MAX_WALS="5"
ETCD_NAME="default"
#ETCD_SNAPSHOT_COUNT="100000"
#ETCD_HEARTBEAT_INTERVAL="100"
#ETCD_ELECTION_TIMEOUT="1000"
#ETCD_QUOTA_BACKEND_BYTES="0"
#ETCD_MAX_REQUEST_BYTES="1572864"
#ETCD_GRPC_KEEPALIVE_MIN_TIME="5s"
#ETCD_GRPC_KEEPALIVE_INTERVAL="2h0m0s"
#ETCD_GRPC_KEEPALIVE_TIMEOUT="20s"
#
#[Clustering]
ETCD_INITIAL_ADVERTISE_PEER_URLS="http://192.168.10.27:2380"
ETCD_ADVERTISE_CLIENT_URLS="http://192.168.10.27:2379"
#ETCD_DISCOVERY=""
#ETCD_DISCOVERY_FALLBACK="proxy"
#ETCD_DISCOVERY_PROXY=""
#ETCD_DISCOVERY_SRV=""
ETCD_INITIAL_CLUSTER="default=http://192.168.10.27:2380"
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster"
ETCD_INITIAL_CLUSTER_STATE="new"
#ETCD_STRICT_RECONFIG_CHECK="true"
#ETCD_ENABLE_V2="true"
#
#[Proxy]
#ETCD_PROXY="off"
#ETCD_PROXY_FAILURE_WAIT="5000"
#ETCD_PROXY_REFRESH_INTERVAL="30000"
#ETCD_PROXY_DIAL_TIMEOUT="1000"
#ETCD_PROXY_WRITE_TIMEOUT="5000"
#ETCD_PROXY_READ_TIMEOUT="0"
#
#[Security]
#ETCD_CERT_FILE=""
#ETCD_KEY_FILE=""
#ETCD_CLIENT_CERT_AUTH="false"
#ETCD_TRUSTED_CA_FILE=""
#ETCD_AUTO_TLS="false"
#ETCD_PEER_CERT_FILE=""
#ETCD_PEER_KEY_FILE=""
#ETCD_PEER_CLIENT_CERT_AUTH="false"
#ETCD_PEER_TRUSTED_CA_FILE=""
#ETCD_PEER_AUTO_TLS="false"
#
#[Logging]
#ETCD_DEBUG="false"
#ETCD_LOG_PACKAGE_LEVELS=""
#ETCD_LOG_OUTPUT="default"
#
#[Unsafe]
#ETCD_FORCE_NEW_CLUSTER="false"
#
#[Version]
#ETCD_VERSION="false"
#ETCD_AUTO_COMPACTION_RETENTION="0"
#
#[Profiling]
#ETCD_ENABLE_PPROF="false"
#ETCD_METRICS="basic"
#
#[Auth]
#ETCD_AUTH_TOKEN="simple"
</pre></td></tr></tbody></table></code></div></div>

<p><em>Noted: Silakan sesuaikan IP dengan IP Node04 dan uncoment rule yang dibutuhkan seperti diatas.</em></p>

<p>Selanjutnya, enable dan start etcd cluster</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node04 ~]#
[root@node04 ~]# systemctl enable etcd
Created symlink /etc/systemd/system/multi-user.target.wants/etcd.service → /usr/lib/systemd/system/etcd.service.
[root@node04 ~]# systemctl start etcd
[root@node04 ~]# systemctl status etcd
</pre></td></tr></tbody></table></code></div></div>

<figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="400" src="/content/images/wordpress/2020/09/4-4-1024x400.png" alt="" class="wp-image-488" srcset="/content/images/wordpress/2020/09/4-4-1024x400.png 1024w, /content/images/wordpress/2020/09/4-4-300x117.png 300w, /content/images/wordpress/2020/09/4-4-768x300.png 768w, /content/images/wordpress/2020/09/4-4.png 1036w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>

<p>Berikutnya enable dan start service patroni di <strong>node01, node02 dan node03</strong></p>

<p><strong>Node01</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node01 ~]#
[root@node01 ~]# systemctl enable patroni
Created symlink /etc/systemd/system/multi-user.target.wants/patroni.service → /usr/lib/systemd/system/patroni.service.
[root@node01 ~]# systemctl start patroni
[root@node01 ~]# systemctl status patroni -l
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node02</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node02 ~]#
[root@node02 ~]# systemctl enable patroni
Created symlink /etc/systemd/system/multi-user.target.wants/patroni.service → /usr/lib/systemd/system/patroni.service.
[root@node02 ~]# systemctl start patroni
[root@node02 ~]# systemctl status patroni -l
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Node03</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node03 ~]#
[root@node03 ~]# systemctl enable patroni
Created symlink /etc/systemd/system/multi-user.target.wants/patroni.service → /usr/lib/systemd/system/patroni.service.
[root@node03 ~]# systemctl start patroni
[root@node03 ~]# systemctl status patroni -l
</pre></td></tr></tbody></table></code></div></div>

<p>Selanjutnya kita akan install HAProxy. Buat apa HAProxy?</p>

<p>Saat mengembangkan aplikasi yang menggunakan database, mungkin sulit untuk melacak titik akhir database jika terus berubah. Menggunakan HAProxy akan menyederhanakan dengan dengan memberikan satu titik akhir atau jalur kemana Anda menghubungkan aplikasi ke database.</p>

<p>HAProxy juga akan sebagai failover atau load balancer tugasnya meneruskan koneksi ke node mana pun yang saat ini menjadi master atau primary (postgresql). Patroni sebagai manajemen postgresql akan memastikan bahwa, pada waktu tertentu, hanya node master postgresql yang akan muncul sebagai online, dan memaksa HAProxy untuk terhubung ke node yang benar.</p>

<p>Jalankan perintah berikut di <strong>Node05</strong> untuk instalasi HAProxy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node05 ~]#
[root@node05 ~]# dnf -y install haproxy
</pre></td></tr></tbody></table></code></div></div>

<p>Konfigurasi HAProxy:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>[root@node05 ~]#
[root@node05 ~]# vim /etc/haproxy/haproxy.cfg
</pre></td></tr></tbody></table></code></div></div>

<p>Berikut full konfigurasi HAProxy</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre>global

        maxconn 100
        log 127.0.0.1 local2

defaults
        log global
        mode tcp
        retries 2
        timeout client 30m
        timeout connect 4s
        timeout server 30m
        timeout check 5s

listen stats
    mode http
    bind *:2233
    stats hide-version
    stats refresh 30s
    stats show-node
    stats auth username:password
    stats enable
    stats uri /

listen postgres
    bind *:5000
    option httpchk
    http-check expect status 200
    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions
    server node1 192.168.10.21:5432 maxconn 100 check port 8008
    server node2 192.168.10.24:5432 maxconn 100 check port 8008
    server node3 192.168.10.28:5432 maxconn 100 check port 8008
</pre></td></tr></tbody></table></code></div></div>

<p><em>Noted: Set default HAProxy menjadi tcp dan input node postgresql</em></p>

<p>Simpan pastikan tidak ada konfigurasi yang salah, lalu restart HAProxy dan pastikan statusnya running</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[root@node05 ~]# haproxy -c -V -f /etc/haproxy/haproxy.cfg
Configuration file is valid
[root@node05 ~]#
[root@node05 ~]# systemctl restart haproxy
[root@node05 ~]# systemctl status haproxy -l
</pre></td></tr></tbody></table></code></div></div>

<p>Langkah terakhir kita akan mencoba melakukan percobaan login ke postgresql menggunakan IP Load Balancer atau HAProxy dan menggunakan port 5000 yang sudah di set up di sisi HAProxy sebelumnya</p>

<figure class="wp-block-image size-large"><img loading="lazy" width="743" height="187" src="/content/images/wordpress/2020/09/7.png" alt="" class="wp-image-489" srcset="/content/images/wordpress/2020/09/7.png 743w, /content/images/wordpress/2020/09/7-300x76.png 300w" sizes="(max-width: 743px) 100vw, 743px" /></figure>

<p>Seperti yang Anda lihat pada gambar diatas saat ini client atau user dapat akses ke sisi database postgresql melalui IP HAProxy.</p>

<p>Silakan akses IP Public HAProxy Anda melalui browser menggunakan port 2233 sesuai konfigurasi HAProxy diatas dan hasilnya seperti berikut</p>

<figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="278" src="/content/images/wordpress/2020/09/5-2-1024x278.png" alt="" class="wp-image-490" srcset="/content/images/wordpress/2020/09/5-2-1024x278.png 1024w, /content/images/wordpress/2020/09/5-2-300x81.png 300w, /content/images/wordpress/2020/09/5-2-768x208.png 768w, /content/images/wordpress/2020/09/5-2-1536x417.png 1536w, /content/images/wordpress/2020/09/5-2.png 1917w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>

<p>Seperti yang Anda lihat pada gambar di atas, baris (node1) disorot dengan warna hijau. Ini menunjukkan bahwa (node1 192.168.10.21) saat ini bertindak sebagai master atau primary dan sisanya (node02, node03) bertindak sebagai standby.</p>

<p>Jika Anda mematikan node master dengan perintah <em>systemctl stop patroni</em> atau dengan mematikan server sepenuhnya, dashboard akan terlihat seperti di bawah ini:</p>

<p>Proses Load Balancing / Failover</p>

<figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="290" src="/content/images/wordpress/2020/09/ha03-1024x290.png" alt="" class="wp-image-493" srcset="/content/images/wordpress/2020/09/ha03-1024x290.png 1024w, /content/images/wordpress/2020/09/ha03-300x85.png 300w, /content/images/wordpress/2020/09/ha03-768x217.png 768w, /content/images/wordpress/2020/09/ha03-1536x435.png 1536w, /content/images/wordpress/2020/09/ha03.png 1912w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>

<p>Saat ini node02 bertindak sebagai master</p>

<figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="275" src="/content/images/wordpress/2020/09/6-1024x275.png" alt="" class="wp-image-491" srcset="/content/images/wordpress/2020/09/6-1024x275.png 1024w, /content/images/wordpress/2020/09/6-300x81.png 300w, /content/images/wordpress/2020/09/6-768x206.png 768w, /content/images/wordpress/2020/09/6-1536x412.png 1536w, /content/images/wordpress/2020/09/6.png 1908w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>

<p>Di bagian Postgres pada gambar di atas, baris (node1) sekarang berwarna merah dan baris (node2) disorot dengan warna hijau. Ini menunjukkan bahwa (node2 192.168.10.24) saat ini bertindak sebagai master.</p>

<p>Catatan: Dalam kasus ini, kebetulan server Postgres kedua dipromosikan menjadi master. Ini mungkin tidak selalu terjadi jika Anda memiliki lebih dari dua node di cluster. Kemungkinan yang sama bahwa server ketiga dapat dipromosikan menjadi master, contoh seperti gambar dibawah ini</p>

<figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="296" src="/content/images/wordpress/2020/09/ha04-1024x296.png" alt="" class="wp-image-494" srcset="/content/images/wordpress/2020/09/ha04-1024x296.png 1024w, /content/images/wordpress/2020/09/ha04-300x87.png 300w, /content/images/wordpress/2020/09/ha04-768x222.png 768w, /content/images/wordpress/2020/09/ha04-1536x444.png 1536w, /content/images/wordpress/2020/09/ha04.png 1917w" sizes="(max-width: 1024px) 100vw, 1024px" /></figure>

<p>Dimaan node01 dan node03 dipromosikan sebagai master.</p>

<p>Selamat mencoba 😁</p>

<p>Please follow and like us:</p>

<p><a href="https://api.follow.it/widgets/icon/VHc3d1lpVGdwRnE5QnV0eERCNUx5RCtvTTVoUkNYS3NNRmd5eVhlQW9tNXRHS3VTbGh6Y0NybkRJRS8zSGpjRDVZb1ZGMlNTSEpJYUpuZzZqNzdnd3VSN3dwM2VlQTF6ejJEaGV5UGRUbnlEcHFNd3luYTV4ZTZtUGowVWI2Q2x8M2kzdnBEeUIrUk5xOFI5TXZ3cHF3bFNQRkRJSGhUNGdrRFd0TlNtdE1OWT0=/OA==/"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/wp-content/plugins/ultimate-social-media-icons/images/follow_subscribe.png" alt="error" /></a></p>

<p><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fbelajarlinux.id%2F%3Fp%3D481%26ghostexport%3Dtrue%26submit%3DDownload+Ghost+File"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/wp-content/plugins/ultimate-social-media-icons/images/visit_icons/fbshare_bck.png" alt="fb-share-icon" title="Facebook Share" /></a></p>

<p><a href="https://twitter.com/intent/tweet?text=High+Availability+PostgreSQL+Cluster+Menggunakan+Patroni+dan+HAProxy+https://belajarlinux.id/?p=481&amp;ghostexport=true&amp;submit=Download Ghost File"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/wp-content/plugins/ultimate-social-media-icons/images/visit_icons/en_US_Tweet.svg" alt="Tweet" title="Tweet" /></a></p>

<p><a href="#"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/wp-content/plugins/ultimate-social-media-icons/images/share_icons/Pinterest_Save/en_US_save.svg" alt="fb-share-icon" title="Pin Share" /></a></p>

<!--kg-card-end: html-->


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/centos/'>centos</a>,
            <a href='/categories/database/'>database</a>,
            <a href='/categories/load-balancer/'>load-balancer</a>
        </div>
        

        <!-- tags -->
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy - Chirpy&url=/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy - Chirpy&u=/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=High Availability PostgreSQL Cluster Menggunakan Patroni dan HAProxy - Chirpy&url=/posts/high-availability-postgresql-cluster-menggunakan-patroni-dan-haproxy/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

  

















  
  </div> <!-- .access -->

  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/memanfaatkan-mariadb-maxscale-sebagai-load-balancing-untuk-galera-cluster-pada-centos-8/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Aug 31, 2020
  

  <i class="unloaded">2020-08-31T23:43:20+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Memanfaatkan MariaDB MaxScale Sebagai Load Balancing Untuk Galera Cluster pada CentOS 8</h3>
            <div class="text-muted small">
              <p>
                





                MariaDB adalah sistem manajemen database relasional yang dikembangkan dari MySQL. MariaDB dikembangkan oleh komunitas pengembang yang sebelumnya berkontribusi untuk database MySQL.

MariaDB saat in...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/membuat-koneksi-php-ke-mariadb-maxscale/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Sep  1, 2020
  

  <i class="unloaded">2020-09-01T21:24:52+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Membuat Koneksi PHP ke MariaDB MaxScale</h3>
            <div class="text-muted small">
              <p>
                





                Saat ini sangat banyak bahasa pemrograman yang dapat digunakan untuk membuat sebuah website statis ataupun dinamis dan salah satu pemrograman yang paling populer bahkan bisa dibilang bahas pemrogra...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/wordpress-high-availability-menggunakan-haproxy-di-centos-8/">
          <div class="card-body">
            <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->





<span class="timeago small"
  

  
   >

  
  

  
    Sep  2, 2020
  

  <i class="unloaded">2020-09-02T21:58:23+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>WordPress High Availability Menggunakan Haproxy di CentOS 8</h3>
            <div class="text-muted small">
              <p>
                





                WordPress salah satu CMS yang paling sering dan banyak digunakan untuk website, baik untuk website pribadi ataupun korporasi.

Pada tutorial kali ini kami akan mencoba mengkombinasikan WordPress de...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/cara-konfigurasi-postgresql-12-replika-streaming-di-centos-8/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Cara Konfigurasi PostgreSQL 12 Replika Streaming di CentOS 8</p>
  </a>
  

  
  <a href="/posts/pengertian-mail-server/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>Pengertian Mail Server</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="https://twitter.com/username">your_full_name</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      

















      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

